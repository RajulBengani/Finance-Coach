{% extends 'coach/layout.html' %}

{% block content %}
<h2>Your Investments</h2>

<p>
    <a href="{% url 'add_investment' %}">Add New Investment</a> |
    <a href="{% url 'add_to_investment' %}">Add to Existing Investment</a>
</p>

{% if investments %}
    <!-- Investment Summary -->
    <h3>Investment Summary</h3>
    <table>
        <thead>
            <tr>
                <th>Investment</th>
                <th>Total Amount</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for investment in investments %}
            <tr class="clickable-row" data-href="{% url 'investment_details' investment.id %}">
                <td>{{ investment.name }}</td>
                <td>{{ investment.total_amount|default:0 }}</td>
                <td>
                    <a href="{% url 'investment_details' investment.id %}">View Details</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Recent Transactions -->
    <h3>Recent Transactions</h3>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Investment</th>
                <th>Description</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for investment in investments %}
                {% if investment.transactions.all %}
                    {% for txn in investment.transactions.all %}
                    <tr>
                        <td>{{ txn.date }}</td>
                        <td>{{ txn.get_transaction_type_display }}</td>
                        <td>{{ investment.name }}</td>
                        <td>{{ txn.description|default:"-" }}</td>
                        <td>{{ txn.amount }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5">No transactions found for {{ investment.name }}.</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>

{% else %}
    <p>You have no investments yet. Start by <a href="{% url 'add_investment' %}">adding your first investment</a>!</p>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".clickable-row").forEach(function(row) {
        row.addEventListener("click", function() {
            window.location = this.dataset.href;
        });
    });
});
</script>

{% endblock %}
